#!/bin/sh
#
# XINIT
# set relevant settings for specific wms including autostart
# (sourced by lightdm and .xinitrc)
#   needs: [dex]
#          [argyllcms]
#          [nitrogen]
#          [dunst]
#          [compton]
#
# file: ~/.xprofile
# v1.4 / 2016.08.23
#
# (c) 2016 Bernd Busse
#

# set config dir and run autostart files with dapper
export WM_SCRIPTS="${HOME}/.config/wmscripts/"
export PATH="${PATH}:${WM_SCRIPTS%/}"

if [[ "${DESKTOP_SESSION}" == *i3 ]]; then
    export I3_CONFIG="${HOME}/.config/i3/"
    dex -ae MATE
    export $(gnome-keyring-daemon -s)
elif [[ "${DESKTOP_SESSION}" == *herbstluftwm ]]; then
    export HLWM_CONFIG="${HOME}/.config/herbstluftwm/"
    dex -ae MATE
    export $(gnome-keyring-daemon -s)
elif [[ "${DESKTOP_SESSION}" == *spectrwm ]]; then
    export SPECTR_CONFIG="${HOME}/.config/spectrwm/"
    dex -ae MATE
    export $(gnome-keyring-daemon -s)
fi

# start urxvt daemon
#urxvtd -q -f -o

# load Xresources
xrdb -merge ~/.Xdefaults
xrdb -merge ~/.Xres_urxvt

# set primary display, if not allready set
xrandr -d ${DISPLAY} --query | grep -e 'primary' &> /dev/null
if [[ ${?} == 1 ]]; then
    monitor="$(xrandr -d ${DISPLAY} --query | grep -e ' connected '| cut -d' ' -f1)"
    xrandr --output ${monitor} --primary
fi

# set display calibration profiles
if [[ ${HOSTNAME} == "sachnix" ]]; then
    dispwin -d 1 -I ~/.local/share/colord/DELL\ U2410\ -\ 20150506.icc &
    dispwin -d 2 -I ~/.local/share/colord/SAMSUNG\ SyncMaster245B\ -\ 20150506.icc &
fi

# (re)set wallpaper with nitrogen
nitrogen --restore &

# start notification-daemon 'dunst'
[[ -z $(pgrep dunst) ]] && dunst &

# start compositor 'compton'
[[ -z $(pgrep compton) ]] && compton &
