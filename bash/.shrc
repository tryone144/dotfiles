#
# BASH
# .little function tools for my bash
# 
# file: ~/.bashrc
# v1.1 / 2015.10.20
#
# (c) 2015 Bernd Busse
#

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# Simple Stopwatch
function stopwatch() {
    date1=$(date +%s); 
    while true; do 
        echo -ne "$(date -u --date @$(($(date +%s) - ${date1})) +%H:%M:%S)\r"; sleep 0.1
    done
}

# Simple countdown timer
function countdown() {
    seconds=${1};
    if [ -z ${seconds} ]; then
        return
    fi
    date1=$(($(date +%s) + ${seconds})); 
    while [ "${date1}" -ne $(date +%s) ]; do 
        echo -ne "$(date -u --date @$((${date1} - $(date +%s) )) +%H:%M:%S)\r"; 
    done
    echo -e "BOOOOOOOMMMM!!!!!!"
}

# Show Batter percentage
function battery() {
    for bat in $(upower -e | grep 'battery'); do
        output="$(upower -i $bat)"
        _name="$(echo "$output" | grep 'native-path' | sed -re 's/^\s*native-path:\s*(.*)$/\1/g')"
        _percentage="$(echo "$output" | grep 'percentage' | sed -re 's/^\s*percentage:\s*([0-9][0-9]%)$/\1/g')"
        _state="$(echo "$output" | grep 'state' | sed -re 's/^\s*state:\s*(.*)$/\1/g')"
        echo "${_name}: ${_percentage} (${_state})"
    done
}

# Manage local and remote proxy settings
function manage_proxy() {
    case ${1} in
        set)
            PROXY_IP="192.168.110.15"
            PROXY_PORT=3128
            echo "Setting proxy to ${PROXY_IP}:${PROXY_PORT}..."
            export http_proxy="http://${PROXY_IP}:${PROXY_PORT}"; export HTTP_PROXY="${http_proxy}"
            export https_proxy="https://${PROXY_IP}:${PROXY_PORT}"; export HTTPS_PROXY="${https_proxy}"
            export ftp_proxy="ftp://${PROXY_IP}:${PROXY_PORT}"; export FTP_PROXY="${https_proxy}"
            export no_proxy="127.0.0.1, localhost, 192.168.110.1, 192.168.110.15"; export NO_PROXY="${no_proxy}"
            gsettings set org.gnome.system.proxy mode 'manual' 
            gsettings set org.gnome.system.proxy.http host "${PROXY_IP}"
            gsettings set org.gnome.system.proxy.http port ${PROXY_PORT}
            gsettings set org.gnome.system.proxy.ftp host "${PROXY_IP}"
            gsettings set org.gnome.system.proxy.ftp port ${PROXY_PORT}
            gsettings set org.gnome.system.proxy.https host "${PROXY_IP}"
            gsettings set org.gnome.system.proxy.https port ${PROXY_PORT}
            gsettings set org.gnome.system.proxy ignore-hosts "['localhost', '127.0.0.0/8', '10.0.0.0/8', '192.168.0.0/16', '172.16.0.0/12' , '*.rs.bussenet.de', '192.168.110.15' ]"
            ;;
        unset)
            echo "Unsetting proxy..."
            unset http_proxy; unset HTTP_PROXY
            unset https_proxy; unset HTTPS_PROXY
            unset ftp_proxy; unset FTP_PROXY
            unset no_proxy; unset NO_PROXY
            gsettings set org.gnome.system.proxy mode 'none' 
            ;;
        *)
            echo "unkown command: ${1}" >&2
            exit 1
            ;;
    esac
}

